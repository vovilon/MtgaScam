<Window x:Class="Phyrexia.ScamDetectorWpf.Xaml.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:Phyrexia.ScamDetectorWpf.ViewModels"
        d:DataContext="{d:DesignInstance viewModels:MainWindowViewModel}"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        mc:Ignorable="d"
        Title="Детектор обмана" 
        WindowState="Maximized">
    
    <Grid IsEnabled="{Binding IsReady}"
          Margin="4">
        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <LinearGradientBrush x:Key="BgBrush" StartPoint="0,0" EndPoint="0,1">
                <GradientStop Offset="0" Color="#888888"/>
                <GradientStop Offset="1" Color="#222222"/>
            </LinearGradientBrush>
            
            <LinearGradientBrush x:Key="CheckedBrush" StartPoint="0,0" EndPoint="0,1">
                <GradientStop Offset="0" Color="#3399DD"/>
                <GradientStop Offset="1" Color="#113399"/>
            </LinearGradientBrush>
            
            <SolidColorBrush x:Key="FontBrush" Color="#DDDDDD"/>
            <SolidColorBrush x:Key="BorderBrush" Color="#333333"/>
            
            <ControlTemplate x:Key="ToggleButton" TargetType="{x:Type ToggleButton}">
                <Border
                    Name="Border"
                    Background="{StaticResource BgBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8,8,8,8">
                    <ContentPresenter
                        HorizontalAlignment="Center"
                        Margin="{TemplateBinding Padding}"
                        VerticalAlignment="Center"
                        Content="{TemplateBinding Content}"
                        TextBlock.FontSize="24"
                        TextBlock.FontWeight="Bold"
                        TextBlock.Foreground="{StaticResource FontBrush}"/>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsChecked" Value="true">
                        <Setter TargetName="Border" Property="Background" Value="{StaticResource CheckedBrush}"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
            
        </Grid.Resources>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        
        <DockPanel Grid.Row="0"
                   Grid.Column="0"
                   HorizontalAlignment="Stretch">
            <RadioButton Content="Constructed" 
                         IsChecked="{Binding IsConstructed}"
                         VerticalAlignment="Center"
                         GroupName="Format"
                         FontSize="16"
                         Margin="4"
                         Padding="4"
                         Template="{StaticResource ToggleButton}"/>
            <RadioButton Content="Limited"
                         GroupName="Format"
                         FontSize="16"
                         Margin="4"
                         Padding="8, 4"
                         VerticalAlignment="Center"
                         Template="{StaticResource ToggleButton}"/>

            <CheckBox Margin="16,4, 0, 4"
                      Content="Yorion"
                      FontSize="16"
                      Padding="4, 4"
                      VerticalContentAlignment="Center"
                      VerticalAlignment="Center"
                      HorizontalAlignment="Right"
                      IsChecked="{Binding IsYorionCompanion}"/>
        </DockPanel>

        <DockPanel Grid.Row="1"
                   Grid.Column="0"
                   Margin="4"
                   HorizontalAlignment="Stretch">
            
            <Label Margin="4"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Left"
                   FontSize="16"
                   Content="Карт взято:"/>
            <xctk:IntegerUpDown VerticalAlignment="Center"
                                Margin="0"
                                FontSize="16"
                                ButtonSpinnerHeight="32"
                                ButtonSpinnerWidth="32"
                                Value="{Binding CardsDrawnCount}"/>
            
            <CheckBox Margin="16, 4, 4, 0 "
                      Content="Все совпадения"
                      FontSize="16"
                      VerticalAlignment="Center"
                      VerticalContentAlignment="Center"
                      HorizontalAlignment="Center"
                      IsChecked="{Binding AllOccurs}"/>
            
            <Button Content="+"
                    Height="36"
                    Width="36"
                    Padding="4"
                    Margin="4,4,0,4"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    DockPanel.Dock="Right"
                    Command="{Binding AddNewCondition}"/>
        </DockPanel>
        
        <ListBox Grid.Row="2"
                 Grid.Column="0"
                 HorizontalContentAlignment="Stretch"
                 ItemsSource="{Binding ConditionList}">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="Black"
                            BorderThickness="1"
                            Margin="4"
                            Padding="4">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox Grid.Row="0"
                                     Grid.Column="0"
                                     FontSize="12"
                                     Text="{Binding Name}"
                                     Margin="4"
                                     Width="200"
                                     Height="24"
                                     VerticalAlignment="Center"
                                     />

                            <Button Grid.Column="0"
                                    Grid.Row="1"
                                    FontSize="16"
                                    Content="Удалить"
                                    Margin="4"
                                    VerticalAlignment="Center"
                                    Command="{Binding DeleteCondition}"
                                    />

                            <Label Grid.Row="0"
                                   Grid.Column="1"
                                   Margin="4"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Right"
                                   HorizontalContentAlignment="Right"
                                   FontSize="16"
                                   Content="Карт в колоде:"/>
                            <xctk:IntegerUpDown Grid.Row="0"
                                                Grid.Column="2"
                                                Margin="4"
                                                FontSize="16"
                                                ButtonSpinnerHeight="32"
                                                ButtonSpinnerWidth="32"
                                                VerticalAlignment="Center"
                                                Value="{Binding CardsInDeckCount}"/>

                            <Label Grid.Row="1"
                                   Grid.Column="1"
                                   Margin="4"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Right"
                                   HorizontalContentAlignment="Right"
                                   FontSize="16"
                                   Content="Получить в руку:"/>
                            <xctk:IntegerUpDown Grid.Row="1"
                                                Grid.Column="2"
                                                Margin="4"
                                                FontSize="16"
                                                ButtonSpinnerHeight="32"
                                                ButtonSpinnerWidth="32"
                                                VerticalAlignment="Center"
                                                Value="{Binding DublicateCount}"/>

                            
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <DockPanel  Grid.Row="0"
                    Grid.Column="1">
            <Button FontSize="24"
                    Content="Посчитать вероятность"
                    Command="{Binding CalculateProbabilityCommand}"
                    Margin="4"
                    Padding="80, 4"/>
            <ProgressBar Minimum="0" Maximum="100" 
                         Margin="4"
                         Value="{Binding Progress, Mode=OneWay}" 
                         Visibility="{Binding IsRunning, Converter={StaticResource BoolToVisibilityConverter}}"/>
        </DockPanel>
        

        <ListBox Grid.Row="1"
                 Grid.RowSpan="2"
                 Grid.Column="1"
                 Margin="4"
                 FontSize="20"
                 ItemsSource="{Binding History}"/>

        <Grid Grid.Row="0" Grid.Column="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Margin="8, 2"
                    Content="Выгрузить из MTGA" 
                    FontSize="16"
                    Padding="4"
                    Command="{Binding ImportDeck}" />
            <Button Grid.Column="1" Margin="8, 2"
                    Content="Сгенерировать руку" 
                    FontSize="16"
                    Padding="4"
                    Command="{Binding GenerateHand}"/>
            <Button Grid.Column="2" Margin="8, 2"
                    Content="Взять карту"
                    FontSize="16"
                    Padding="4"
                    Command="{Binding DrawCard}"/>
        </Grid>
        
        <ListBox Grid.Row="1"
                 Grid.RowSpan="2"
                 Grid.Column="2"
                 Margin="8, 4, 8, 0"
                 ItemsSource="{Binding SampleHand}"/>

    </Grid>
</Window>
